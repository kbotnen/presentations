<!doctype html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>Puppet - Opensource automation software</title>
		<meta name="description" content="Puppet">
		<meta name="author" content="Kristian Botnen">
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
		<link rel="stylesheet" href="css/reveal.min.css">
		<link rel="stylesheet" href="css/theme/default.css" id="theme">
		<!-- For syntax highlighting -->
		<link rel="stylesheet" href="lib/css/zenburn.css">
		<!-- If the query includes 'print-pdf', use the PDF print sheet -->
		<script>
			document.write( '<link rel="stylesheet" href="css/print/' + ( window.location.search.match( /print-pdf/gi ) ? 'pdf' : 'paper' ) + '.css" type="text/css" media="print">' );
		</script>
		<!--[if lt IE 9]>
		<script src="lib/js/html5shiv.js"></script>
		<![endif]-->
	</head>
	<body>
		<div class="reveal">
			<!-- Any section element inside of this container is displayed as a slide -->
			<div class="slides">
				<section>
					<h3>Puppet</h3>
					<h3>Opensource Automation Software</h3>
					<p>
						<small>Presentation by <a href="http://ukl.b.uib.no/">Kristian Botnen</a></small>
					</p>
					<aside class="notes">
						Speakers deck available, hit 's' on your keyboard. Overview of all slides, hit 'ESC' on your keyboard.
					</aside>	
				</section>
				<section>
					<h3>A brief history</h3>
					<ul>
						<li class="fragment">ssh looping as a configuration tool</li>
						<li class="fragment">closed source, high cost software from a big vendor</li>
						<li class="fragment">no central repository for configuration items</li>
					</ul>
				</section>
				<section>
					<h3>What is puppet?</h3>
					<li class="fragment">ruby based</li>
					<li class="fragment">three main components, puppet, facter and hiera</li>
					<li class="fragment">open source, community</li>					
				</section>				
				<section>
					<h3>How it works?</h3>
					<ul>
						<li class="fragment">define desired state for your infrastructure</li>
						<li class="fragment">configuration is code which accomodate versioncontrol</li>
						<li class="fragment">you tell what you need, puppet takes care of how</li>
					</ul>
				</section>
				<section>
					<h3>Example of creating a user</h3>
					<pre>
						class accounts ($uid,$realname,$pass,$username,$status,){
						  define singleuser ($uid, $realname, $pass, $username, $status) {
						    user { $username:
						      ensure            =>  $status,
						      uid               =>  $uid,
						      gid               =>  $username,
						      shell             =>  '/bin/bash',
						      home              =>  "/home/${username}",
						      comment           =>  $realname,
						      password          =>  $pass,
						      managehome        =>  true,
						      require           =>  Group[$username],
						    }
						    group { $username:
						      gid               =>  $uid,
						    }
						    file { "/home/${username}":
						      ensure            =>  directory,
						      owner             =>  $username,
						      group             =>  $username,
						      mode              =>  0711,
						      require           =>  [ User[$username], Group[$username] ],
						    }
						  }
						}
					</pre>
				</section>
				<section>
					<h3>Example of creating a user</h3>
					<pre>
						  accounts::singleuser { 'Homer Simpson':
						    uid             =>  533,
						    realname        =>  'Homer Simpson',
						    pass           =>  'asuperlongandcomplexpasswordhashwithsalt',
						    username        =>  'homer',
						    status          =>  'present',
						  }
					</pre>
					<h3 class="fragment">will probably work on mac, freebsd, and various linux flavors</h3>
				</section>				
				
				<section>
					<h3>Puppet modules</h3>
					<ul>
						<li class="fragment">accounts in the example we saw, is a module</li>
						<li class="fragment">a lot of modules are available from puppetlabs and the community</li>
						<li class="fragment">not all modules are of good quality</li>
						<li class="fragment">written in a declarative "ruby-like" language</li>
						<li class="fragment">allows inline ruby</li>
					</ul>
				</section>
				<section>
					<h3>Module development at UIB</h3>
					<ul>
						<li class="fragment">foreman and redmine appstack</li>
						<li class="fragment">galicaster for DigUIB</li>
						<li class="fragment">crypt, munki, cups, ha-proxy, +++</li>
					</ul>
				</section>
				<section>
					<h3>Example of module use, Foreman server </h3>
					<pre>
							1	node 'aserver.uib.no' {
							2 	  class { 'platform::el6::base':
							3 	    env  => 'prod'
							4 	  }
							5 	
							6 	  class { 'app::web::foreman':
							7 	    service_name => 'foremangui.uib.no',
							8 	    backend => pgsql,
							9 	    ssl_host => $::fqdn
							10 	  }
							11 	}
					</pre>
				</section>
				<section>
					<h3>Puppet infrastructure at UIB</h3>
					<ul>
						<li class="fragment">6 puppetmasters, dev test and production</li>
						<li class="fragment">4 external node classifiers (foreman), test and production</li>
						<li class="fragment">servermachines and clientmachines are separated</li>
					</ul>
				</section>
				<section>
					<h3>Node classification</h3>
					<ul>
						<li class="fragment">Foreman makes it easy to classify new nodes</li>
						<li class="fragment">We classify into group based on faculty, dept</li>
						<li class="fragment">Configuration items (i.e packages) are tied to groups</li>
					</ul>
				</section>				
				<section>
					<h3>Foreman list all managed hosts</h3>
						<a class="fragment" class="image">
							<img src="./pictures/foreman_hostlist.png" alt="Foreman hostlist">
						</a>
				</section>				
				<section>
					<h3>Foreman list host details</h3>
						<a class="fragment" class="image">
							<img src="./pictures/foreman_hostdetails.png" alt="Foreman host details">
						</a>
				</section>		
				<section>
					<h3>Foreman classification into group</h3>
						<a class="fragment" class="image">
							<img src="./pictures/foreman_hostgroups.png" alt="Foreman hostgroups">
						</a>
				</section>				
				<section>
					<h3>Shared infrastructure, shared configuration code</h3>
					<ul>
						<li class="fragment">Redhat, Ubuntu and Mac deploys from the same infrastructure</li>
						<li class="fragment">Redhat, Ubuntu and Mac use the same configuration codebase</li>
						<li class="fragment">Redhat, Ubuntu and Mac use the same gui for classification</li>
					</ul>
				</section>
				<section>
					<h1>THE END</h1>
					<h3 class="fragment">questions?</h3>
				</section>

			</div>

		</div>

		<script src="lib/js/head.min.js"></script>
		<script src="js/reveal.min.js"></script>

		<script>

			// Full list of configuration options available here:
			// https://github.com/hakimel/reveal.js#configuration
			Reveal.initialize({
				controls: true,
				progress: true,
				history: true,
				center: true,

				theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
				transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none

				// Optional libraries used to extend on reveal.js
				dependencies: [
					{ src: 'lib/js/classList.js', condition: function() { return !document.body.classList; } },
					{ src: 'plugin/markdown/marked.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/markdown/markdown.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
					{ src: 'plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
					{ src: 'plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
					{ src: 'plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/search/search.js', async: true, condition: function() { return !!document.body.classList; } }
					// { src: 'plugin/remotes/remotes.js', async: true, condition: function() { return !!document.body.classList; } }
				]
			});

		</script>

	</body>
</html>
